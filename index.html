<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Нетология ДПО — Mini-app (Liquid Glass)</title>

    <!-- Telegram WebApp SDK (безопасный фолбэк) -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 UMD -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel для JSX (удобно для демо; в проде лучше собрать) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      :root { --sab: env(safe-area-inset-bottom); }
      /* ===== Liquid Glass helpers ===== */
      .glass {
        background: rgba(255,255,255,0.16);
        backdrop-filter: blur(18px);
        -webkit-backdrop-filter: blur(18px);
        border: 1px solid rgba(255,255,255,0.22);
      }
      .glass-strong {
        background: rgba(255,255,255,0.22);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        border: 1px solid rgba(255,255,255,0.28);
      }
      .neon-ring { box-shadow: 0 0 0 1px rgba(255,255,255,.25), 0 8px 24px rgba(0,210,255,.25), inset 0 1px 0 rgba(255,255,255,.35); }
      .pressable { transition: transform .08s ease, filter .2s ease, box-shadow .2s ease; }
      .pressable:active { transform: translateY(1px) scale(.995); filter: saturate(1.05); }

      /* Таблица: на мобиле оставляем именно таблицу, даём скролл по X и липкий первый столбец */
      .table-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }
      .sticky-first th:first-child, .sticky-first td:first-child {
        position: sticky; left: 0; z-index: 2;
        background: rgba(255,255,255,0.85);
        backdrop-filter: blur(12px);
      }
      @media (prefers-color-scheme: dark) {
        .sticky-first th:first-child, .sticky-first td:first-child { background: rgba(20,20,20,0.72); }
      }

      /* Фон-градиент «Нетологии» (из твоего референса) */
      body {
        min-height: 100vh;
        background: radial-gradient(1200px 600px at 10% -10%, rgba(255,255,255,.6) 0%, rgba(255,255,255,0) 45%),
                    linear-gradient(135deg, #A0E9FF 0%, #00D2FF 48%, #24B6FF 100%);
      }
    </style>
  </head>

  <body class="min-h-screen">
    <!-- Декоративные «жидкие» лужицы (SVG, как в iOS Control Center) -->
    <svg class="fixed inset-0 -z-10 w-full h-full pointer-events-none" aria-hidden="true">
      <defs>
        <!-- Градиент «Нетологии» для акцентов -->
        <linearGradient id="netologyGradient" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#A0E9FF"/>
          <stop offset="0.52" stop-color="#00D2FF"/>
          <stop offset="1" stop-color="#24B6FF"/>
        </linearGradient>
        <!-- Мягкий голубой для подсветки -->
        <radialGradient id="blobCyan" cx="50%" cy="50%" r="50%">
          <stop offset="0" stop-color="#00D2FF" stop-opacity=".35"/>
          <stop offset="1" stop-color="#00D2FF" stop-opacity="0"/>
        </radialGradient>
        <!-- Бирюзовый -->
        <radialGradient id="blobMint" cx="50%" cy="50%" r="50%">
          <stop offset="0" stop-color="#A0E9FF" stop-opacity=".35"/>
          <stop offset="1" stop-color="#A0E9FF" stop-opacity="0"/>
        </radialGradient>
      </defs>
      <g>
        <circle cx="12%" cy="8%" r="220" fill="url(#blobMint)"/>
        <circle cx="88%" cy="14%" r="260" fill="url(#blobCyan)"/>
        <circle cx="92%" cy="82%" r="220" fill="url(#blobMint)"/>
        <circle cx="10%" cy="88%" r="200" fill="url(#blobCyan)"/>
      </g>
    </svg>

    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;

      /* ========= Brand & theme ========= */
      const BRAND = {
        primary: "#00D2FF",
        heading: "#0b0b0b",
        text: "#1f1f1f",
        border: "rgba(255,255,255,.28)"
      };

      const getTG = () => (typeof window !== 'undefined' ? window?.Telegram?.WebApp : undefined);
      const openUrl = (url) => {
        const tg = getTG();
        if (tg?.openLink) tg.openLink(url, { try_instant_view: false });
        else window.open(url, '_blank', 'noopener,noreferrer');
      };
      const openTelegram = (url) => {
        const tg = getTG();
        if (tg?.openTelegramLink) tg.openTelegramLink(url);
        else window.open(url, '_blank', 'noopener,noreferrer');
      };
      const haptic = {
        light: () => getTG()?.HapticFeedback?.impactOccurred?.('light'),
        selection: () => getTG()?.HapticFeedback?.selectionChanged?.(),
        success: () => getTG()?.HapticFeedback?.notificationOccurred?.('success'),
      };

      function getThemeFromTG() {
        const p = getTG()?.themeParams || {};
        const dark = getTG()?.colorScheme === 'dark';
        return {
          dark,
          bg: 'transparent',
          panel: dark ? 'rgba(20,22,24,.55)' : 'rgba(255,255,255,.55)',
          panelStrong: dark ? 'rgba(30,32,36,.65)' : 'rgba(255,255,255,.7)',
          text: p.text_color || (dark ? '#ECECEC' : '#1f1f1f'),
          heading: p.text_color || (dark ? '#FFFFFF' : '#0b0b0b'),
          border: p.section_separator_color || BRAND.border,
          buttonText: p.button_text_color || '#FFFFFF',
        };
      }
      function useTelegramTheme() {
        const [theme, setTheme] = useState(getThemeFromTG());
        useEffect(() => {
          const tg = getTG();
          const onChange = () => setTheme(getThemeFromTG());
          tg?.onEvent?.('themeChanged', onChange);
          return () => tg?.offEvent?.('themeChanged', onChange);
        }, []);
        return theme;
      }

      /* ========= Data ========= */
      const PROGRAMS = [
        {
          id: 'dpo-python-mfti',
          title: 'Python: от кода к стартапу',
          partners: ['МФТИ'],
          start_date: '2025-10-20',
          duration_months_est: 7,
          price_full_rub: 158400,
          price_from_per_month_rub: 6947,
          landing_url: 'https://netology.ru/programs/razrabotchik-на-python-с-mfti',
          audience: [
            'Новичкам, которые хотят войти в разработку на Python',
            'Аналитикам и инженерам для автоматизации задач',
            'Специалистам смежных областей (QA, DevOps, BI)'
          ],
          diploma: 'Два диплома о профпереподготовке: МФТИ и Нетологии',
          learn: [
            'Python, ООП, API, БД',
            'Web/скрипты/боты, деплой',
            'Проект от идеи до MVP'
          ],
          about: 'Путь от базового кода до работающего прототипа с питчем.'
        },
        {
          id: 'dpo-ai-pm-mfti',
          title: 'Руководитель проектов в области ИИ',
          partners: ['МФТИ'],
          start_date: '2025-12-08',
          duration_months_est: 3,
          price_full_rub: 114700,
          price_from_per_month_rub: 5031,
          landing_url: 'https://netology.ru/programs/rukovoditel-proektov-v-oblasti-iskusstvennogo-intellekta-dpo-mfti',
          audience: [
            'Менеджерам и продактам, запускающим AI-инициативы',
            'Руководителям, внедряющим ИИ',
            'Координаторам ML/DS-команд'
          ],
          diploma: 'Два удостоверения о повышении квалификации: МФТИ и Нетологии',
          learn: [
            'Цикл AI-проекта и внедрение',
            'Оценка эффекта, рисков, соответствия',
            'Коммуникация бизнес ↔ ML-команда'
          ],
          about: 'Системный менеджмент AI-проектов от постановки до релиза.'
        },
        /* добавь остальные программы по желанию — структура та же */
      ];
      const rub = (n) => new Intl.NumberFormat('ru-RU').format(n);
      const dstr = (s) => new Date(s).toLocaleDateString('ru-RU', { day: '2-digit', month: 'long', year: 'numeric' });

      /* ========= UI primitives ========= */
      const Chip = ({children}) => (
        <span className="px-2 py-1 rounded-full text-[11px] leading-none glass neon-ring text-gray-900/90 dark:text-white/90">
          {children}
        </span>
      );

      function TopBar({ theme }) {
        return (
          <div className="sticky top-0 z-20">
            <div className="mx-auto max-w-5xl px-4 pt-[max(12px,env(safe-area-inset-top))] pb-3">
              <div className="glass neon-ring rounded-2xl px-3 py-2 flex items-center justify-between pressable">
                <div className="flex items-center gap-2">
                  <!-- простая текстовая версия логотипа, можно заменить на твой SVG -->
                  <span className="text-sm font-semibold bg-clip-text text-transparent" style={{backgroundImage: 'url(#)'}} >
                    <span style="background:linear-gradient(90deg,#111, #333); -webkit-background-clip:text; background-clip:text;">Нетология · ДПО</span>
                  </span>
                </div>
                <button
                  className="px-3 py-1.5 rounded-xl text-sm text-white pressable"
                  style={{ background: 'url(#)', backgroundImage: 'linear-gradient(90deg,#00D2FF,#24B6FF)' }}
                  onClick={() => openTelegram('https://t.me/netology')}
                >
                  Написать менеджеру
                </button>
              </div>
            </div>
          </div>
        );
      }

      function Modal({ title, onClose, children, theme }) {
        useEffect(() => {
          const tg = getTG();
          try { tg?.BackButton?.show(); } catch {}
          const handler = () => onClose?.();
          tg?.onEvent?.('backButtonClicked', handler);
          return () => {
            try { tg?.BackButton?.hide(); } catch {}
            tg?.offEvent?.('backButtonClicked', handler);
          };
        }, [onClose]);

        return (
          <div className="fixed inset-0 z-50 flex items-end md:items-center justify-center">
            <div className="absolute inset-0 bg-black/40" onClick={onClose} />
            <div className="relative w-full md:max-w-2xl md:rounded-3xl glass-strong neon-ring md:shadow-2xl">
              <div className="p-4 md:p-6">
                <div className="flex items-start justify-between gap-3">
                  <h3 className="text-lg font-semibold" style={{color: theme.heading}}>{title}</h3>
                  <button onClick={onClose} className="text-sm opacity-80 hover:opacity-100">Закрыть</button>
                </div>
                {children}
              </div>
            </div>
          </div>
        );
      }

      function ProgramCard({ p, onCompareToggle, selected, theme }) {
        const [open, setOpen] = useState(false);
        return (
          <div className="glass neon-ring rounded-3xl p-4 md:p-5 pressable">
            <div className="flex items-start justify-between gap-3">
              <div>
                <div className="text-base md:text-lg font-semibold" style={{color: theme.heading}}>
                  {p.title}
                </div>
                <div className="mt-1 text-sm opacity-80">Партнёр: {p.partners.join(', ')}</div>
                <div className="mt-3 flex flex-wrap gap-1.5">
                  <Chip>Старт: {dstr(p.start_date)}</Chip>
                  <Chip>{p.duration_months_est} мес</Chip>
                  <Chip>{rub(p.price_full_rub)} ₽</Chip>
                  <Chip>от {rub(p.price_from_per_month_rub)} ₽/мес</Chip>
                </div>
              </div>
              <button
                onClick={() => onCompareToggle(p.id)}
                className={`px-3 py-2 rounded-xl text-xs md:text-sm glass neon-ring pressable ${selected ? 'font-semibold' : ''}`}
              >
                {selected ? 'В сравнении' : 'Сравнить'}
              </button>
            </div>

            <div className="mt-4 flex gap-2">
              <button
                className="flex-1 py-2 rounded-xl text-white pressable"
                style={{ backgroundImage: 'linear-gradient(90deg,#00D2FF,#24B6FF)'}}
                onClick={() => openUrl(p.landing_url)}
              >
                Открыть программу
              </button>
              <button
                className="flex-1 py-2 rounded-xl pressable glass"
                onClick={() => setOpen(true)}
              >
                Подробнее
              </button>
            </div>

            {open && (
              <Modal title={p.title} onClose={() => setOpen(false)} theme={theme}>
                <div className="mt-2 text-sm opacity-90">{p.about}</div>

                <div className="mt-4">
                  <div className="text-sm font-medium" style={{color: theme.heading}}>Кому подойдёт</div>
                  <ul className="list-disc ml-5 mt-1 text-sm opacity-90 space-y-1">
                    {p.audience.map((a,i)=><li key={i}>{a}</li>)}
                  </ul>
                </div>

                <div className="mt-4">
                  <div className="text-sm font-medium" style={{color: theme.heading}}>Чему научитесь</div>
                  <ul className="list-disc ml-5 mt-1 text-sm opacity-90 space-y-1">
                    {p.learn.map((a,i)=><li key={i}>{a}</li>)}
                  </ul>
                </div>

                <div className="mt-4 text-sm opacity-90">
                  <span className="font-medium">Документ: </span>{p.diploma}
                </div>

                <div className="mt-5 flex flex-wrap gap-2">
                  <button
                    className="px-4 py-2 rounded-xl text-white pressable"
                    style={{ backgroundImage: 'linear-gradient(90deg,#00D2FF,#24B6FF)'}}
                    onClick={() => openUrl(p.landing_url)}
                  >
                    Перейти на сайт
                  </button>
                  <button
                    className="px-4 py-2 rounded-xl glass pressable"
                    onClick={() => openTelegram('https://t.me/netology')}
                  >
                    Написать менеджеру
                  </button>
                </div>
              </Modal>
            )}
          </div>
        );
      }

      /* ======== Compare Table — всегда таблица, с горизонтальным скроллом на мобиле ======== */
      function CompareTable({ ids, onReset, theme }) {
        const data = PROGRAMS.filter(p => ids.includes(p.id));
        if (!data.length) return null;

        return (
          <div className="glass neon-ring rounded-3xl p-4">
            <div className="flex items-center justify-between gap-2">
              <div className="text-base font-semibold" style={{color: theme.heading}}>Сравнение программ</div>
              <button onClick={onReset} className="px-3 py-1.5 rounded-xl text-sm glass pressable">Сбросить</button>
            </div>

            <div className="table-scroll mt-3 rounded-2xl">
              <table className="min-w-[760px] w-full text-sm leading-snug sticky-first">
                <thead>
                  <tr className="text-left">
                    <th className="py-2 pr-3 w-[28%]">Программа</th>
                    <th className="py-2 pr-3 w-[16%]">Вуз-партнёр</th>
                    <th className="py-2 pr-3 w-[12%]">Старт</th>
                    <th className="py-2 pr-3 w-[12%]">Длительность</th>
                    <th className="py-2 pr-3 w-[12%]">Цена</th>
                    <th className="py-2 pr-3 w-[14%]">От ₽/мес</th>
                    <th className="py-2 pr-3 w-[40%]">Навыки</th>
                  </tr>
                </thead>
                <tbody>
                  {data.map(p => (
                    <tr key={p.id} className="border-t border-white/30">
                      <td className="py-2 pr-3 font-medium">{p.title}</td>
                      <td className="py-2 pr-3">{p.partners.join(', ')}</td>
                      <td className="py-2 pr-3">{dstr(p.start_date)}</td>
                      <td className="py-2 pr-3">{p.duration_months_est} мес</td>
                      <td className="py-2 pr-3">{rub(p.price_full_rub)} ₽</td>
                      <td className="py-2 pr-3">{rub(p.price_from_per_month_rub)} ₽</td>
                      <td className="py-2 pr-3"><span className="opacity-90">{p.learn.join(' · ')}</span></td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        );
      }

      /* ========= Filters ========= */
      function Filters({ partner, setPartner, theme }) {
        const partners = useMemo(() => {
          const set = new Set();
          PROGRAMS.forEach(p => p.partners.forEach(x => set.add(x)));
          return ['Все вузы', ...Array.from(set)];
        }, []);
        return (
          <div className="flex gap-2">
            <select
              value={partner}
              onChange={(e)=>{ haptic.selection(); setPartner(e.target.value); }}
              className="w-full md:w-1/3 glass neon-ring rounded-2xl px-3 py-2"
            >
              {partners.map(p => <option key={p} value={p}>{p}</option>)}
            </select>
          </div>
        );
      }

      /* ========= App ========= */
      function App() {
        const [partner, setPartner] = useState('Все вузы');
        const [compareIds, setCompareIds] = useState([]);
        const theme = useTelegramTheme();

        useEffect(() => {
          const tg = getTG();
          if (tg) {
            try { tg.ready(); tg.expand?.(); tg.setHeaderColor?.('bg_color'); tg.setBackgroundColor?.('secondary_bg_color'); } catch {}
          }
        }, []);

        const filtered = useMemo(
          () => PROGRAMS.filter(p => partner === 'Все вузы' || p.partners.includes(partner)),
          [partner]
        );

        const toggleCompare = (id) =>
          setCompareIds(prev => (prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id].slice(-4)));

        return (
          <div className="min-h-screen">
            <TopBar theme={theme} />
            <main className="max-w-5xl mx-auto px-4 pb-[calc(40px+var(--sab))]">
              <header className="pt-3 pb-2">
                <h1 className="text-lg md:text-xl font-semibold" style={{color: theme.heading}}>
                  Программы ДПО с дипломом вуза
                </h1>
                <p className="opacity-90 text-sm md:text-base">
                  Усильте резюме и подтвердите навыки документами партнёрского вуза и Нетологии.
                </p>
              </header>

              <section className="mt-3">
                <Filters partner={partner} setPartner={setPartner} theme={theme} />
              </section>

              <section className="mt-4">
                <CompareTable ids={compareIds} onReset={()=>setCompareIds([])} theme={theme} />
              </section>

              <section className="mt-4 grid gap-3">
                {filtered.map(p => (
                  <ProgramCard key={p.id} p={p} onCompareToggle={toggleCompare} selected={compareIds.includes(p.id)} theme={theme} />
                ))}
              </section>

              <footer className="text-center text-xs opacity-80 mt-8">
                Информация не является публичной офертой. Уточняйте условия у менеджера.
              </footer>
            </main>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
