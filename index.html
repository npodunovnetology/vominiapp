<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Нетология ДПО — Mini-app (Liquid Glass, fixed)</title>

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 UMD -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX (dev) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      :root { --sab: env(safe-area-inset-bottom); }
      /* Liquid glass helpers */
      .glass {
        background: rgba(255,255,255,0.16);
        backdrop-filter: blur(18px);
        -webkit-backdrop-filter: blur(18px);
        border: 1px solid rgba(255,255,255,0.22);
      }
      .glass-strong {
        background: rgba(255,255,255,0.22);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        border: 1px solid rgba(255,255,255,0.28);
      }
      .neon-ring { box-shadow: 0 0 0 1px rgba(255,255,255,.25), 0 8px 24px rgba(0,210,255,.22), inset 0 1px 0 rgba(255,255,255,.35); }
      .pressable { transition: transform .08s ease, filter .2s ease, box-shadow .2s ease; }
      .pressable:active { transform: translateY(1px) scale(.995); filter: saturate(1.05); }

      /* Compare table: keep as table on mobile */
      .table-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }
      .sticky-first th:first-child, .sticky-first td:first-child {
        position: sticky; left: 0; z-index: 2;
        background: rgba(255,255,255,0.82);
        backdrop-filter: blur(10px);
      }
      @media (prefers-color-scheme: dark) {
        .sticky-first th:first-child, .sticky-first td:first-child { background: rgba(20,20,20,0.72); }
      }
    </style>
  </head>

  <body class="min-h-screen bg-[color:var(--tg-theme-secondary-bg-color,#f6f7f8)]">
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;

      /* ===== Brand & Telegram theme ===== */
      const BRAND = {
        primary1: "#A0E9FF",
        primary2: "#00D2FF",
        primary3: "#24B6FF",
      };

      const getTG = () => (typeof window !== 'undefined' ? window?.Telegram?.WebApp : undefined);
      const openUrl = (url) => {
        const tg = getTG();
        if (tg?.openLink) tg.openLink(url, { try_instant_view: false });
        else window.open(url, '_blank', 'noopener,noreferrer');
      };
      const openTelegram = (url) => {
        const tg = getTG();
        if (tg?.openTelegramLink) tg.openTelegramLink(url);
        else window.open(url, '_blank', 'noopener,noreferrer');
      };
      const haptic = {
        light: () => getTG()?.HapticFeedback?.impactOccurred?.('light'),
        selection: () => getTG()?.HapticFeedback?.selectionChanged?.(),
      };

      function getThemeFromTG() {
        const p = getTG()?.themeParams || {};
        const dark = getTG()?.colorScheme === 'dark';
        return {
          dark,
          text: p.text_color || (dark ? '#ECECEC' : '#1f1f1f'),
          heading: p.text_color || (dark ? '#FFFFFF' : '#0b0b0b'),
          panel: dark ? 'rgba(20,22,24,.55)' : 'rgba(255,255,255,.55)',
          border: p.section_separator_color || 'rgba(0,0,0,.08)',
        };
      }
      function useTelegramTheme() {
        const [theme, setTheme] = useState(getThemeFromTG());
        useEffect(() => {
          const tg = getTG();
          const onChange = () => setTheme(getThemeFromTG());
          tg?.onEvent?.('themeChanged', onChange);
          return () => tg?.offEvent?.('themeChanged', onChange);
        }, []);
        return theme;
      }

      /* ===== Data (пример — добавь остальные по той же схеме) ===== */
      const PROGRAMS = [
        {
          id: 'dpo-python-mfti',
          title: 'Python: от кода к стартапу',
          partners: ['МФТИ'],
          start_date: '2025-10-20',
          duration_months_est: 7,
          price_full_rub: 158400,
          price_from_per_month_rub: 6947,
          landing_url: 'https://netology.ru/programs/razrabotchik-na-python-s-mfti',
          audience: [
            'Новичкам, которые хотят войти в разработку на Python',
            'Аналитикам и инженерам для автоматизации задач',
            'Специалистам смежных ролей (QA, DevOps, BI)',
          ],
          diploma: 'Два диплома о профпереподготовке: МФТИ и Нетологии',
          learn: ['Python, API, БД', 'Web/боты/деплой', 'Проект от идеи до MVP'],
          about: 'Путь от базового кода до работающего прототипа и питча.',
        },
        {
          id: 'dpo-ai-pm-mfti',
          title: 'Руководитель проектов в области ИИ',
          partners: ['МФТИ'],
          start_date: '2025-12-08',
          duration_months_est: 3,
          price_full_rub: 114700,
          price_from_per_month_rub: 5031,
          landing_url: 'https://netology.ru/programs/rukovoditel-proektov-v-oblasti-iskusstvennogo-intellekta-dpo-mfti',
          audience: [
            'Менеджерам и продактам, запускающим AI-инициативы',
            'Руководителям, внедряющим ИИ',
            'Координаторам ML/DS-команд',
          ],
          diploma: 'Два удостоверения о повышении квалификации: МФТИ и Нетологии',
          learn: ['Цикл AI-проекта', 'Оценка эффекта и рисков', 'Коммуникация бизнес ↔ ML'],
          about: 'Системный менеджмент AI-проектов от постановки до релиза.',
        },
      ];

      const rub = (n) => new Intl.NumberFormat('ru-RU').format(n);
      const dstr = (s) => new Date(s).toLocaleDateString('ru-RU', { day: '2-digit', month: 'long', year: 'numeric' });

      /* ===== UI Primitives ===== */
      const Chip = ({children}) => (
        <span className="px-2 py-1 rounded-full text-[11px] leading-none glass neon-ring text-gray-900/85 dark:text-white/90">
          {children}
        </span>
      );

      function TopBar({ theme }) {
        const gradient = `linear-gradient(90deg, ${BRAND.primary2}, ${BRAND.primary3})`;
        return (
          <div className="sticky top-0 z-20" style={{ backdropFilter: 'saturate(140%) blur(6px)' }}>
            <div className="mx-auto max-w-5xl px-4 pt-[max(12px,env(safe-area-inset-top))] pb-3">
              <div className="rounded-2xl px-3 py-2 pressable neon-ring" style={{ background: theme.panel }}>
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <span
                      className="text-sm md:text-base font-semibold text-transparent bg-clip-text select-none"
                      style={{ backgroundImage: gradient, WebkitBackgroundClip: 'text' }}
                    >
                      Нетология · ДПО
                    </span>
                  </div>
                  <button
                    className="px-3 py-1.5 rounded-xl text-sm text-white pressable"
                    style={{ backgroundImage: gradient }}
                    onClick={() => openTelegram('https://t.me/netology')}
                  >
                    Написать менеджеру
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      function Modal({ title, onClose, children, theme }) {
        useEffect(() => {
          const tg = getTG();
          try { tg?.BackButton?.show(); } catch {}
          const handler = () => onClose?.();
          tg?.onEvent?.('backButtonClicked', handler);
          return () => {
            try { tg?.BackButton?.hide(); } catch {}
            tg?.offEvent?.('backButtonClicked', handler);
          };
        }, [onClose]);

        return (
          <div className="fixed inset-0 z-50 flex items-end md:items-center justify-center">
            <div className="absolute inset-0 bg-black/45" onClick={onClose} />
            <div className="relative w-full md:max-w-2xl md:rounded-3xl glass-strong neon-ring md:shadow-2xl">
              <div className="p-4 md:p-6">
                <div className="flex items-start justify-between gap-3">
                  <h3 className="text-lg font-semibold" style={{color: theme.heading}}>{title}</h3>
                  <button onClick={onClose} className="text-sm opacity-80 hover:opacity-100">Закрыть</button>
                </div>
                {children}
              </div>
            </div>
          </div>
        );
      }

      function ProgramCard({ p, onCompareToggle, selected, theme }) {
        const [open, setOpen] = useState(false);
        const gradient = `linear-gradient(90deg, ${BRAND.primary2}, ${BRAND.primary3})`;
        return (
          <div className="rounded-3xl p-4 md:p-5 pressable neon-ring" style={{ background: theme.panel }}>
            <div className="flex items-start justify-between gap-3">
              <div>
                <div className="text-base md:text-lg font-semibold" style={{color: theme.heading}}>
                  {p.title}
                </div>
                <div className="mt-1 text-sm opacity-80">Партнёр: {p.partners.join(', ')}</div>
                <div className="mt-3 flex flex-wrap gap-1.5">
                  <Chip>Старт: {dstr(p.start_date)}</Chip>
                  <Chip>{p.duration_months_est} мес</Chip>
                  <Chip>{rub(p.price_full_rub)} ₽</Chip>
                  <Chip>от {rub(p.price_from_per_month_rub)} ₽/мес</Chip>
                </div>
              </div>
              <button
                onClick={() => onCompareToggle(p.id)}
                className={`px-3 py-2 rounded-xl text-xs md:text-sm pressable glass ${selected ? 'font-semibold' : ''}`}
              >
                {selected ? 'В сравнении' : 'Сравнить'}
              </button>
            </div>

            <div className="mt-4 flex gap-2">
              <button
                className="flex-1 py-2 rounded-xl text-white pressable"
                style={{ backgroundImage: gradient }}
                onClick={() => openUrl(p.landing_url)}
              >
                Открыть программу
              </button>
              <button
                className="flex-1 py-2 rounded-xl pressable glass"
                onClick={() => setOpen(true)}
              >
                Подробнее
              </button>
            </div>

            {open && (
              <Modal title={p.title} onClose={() => setOpen(false)} theme={theme}>
                <div className="mt-2 text-sm opacity-90">{p.about}</div>

                <div className="mt-4">
                  <div className="text-sm font-medium" style={{color: theme.heading}}>Кому подойдёт</div>
                  <ul className="list-disc ml-5 mt-1 text-sm opacity-90 space-y-1">
                    {p.audience.map((a,i)=><li key={i}>{a}</li>)}
                  </ul>
                </div>

                <div className="mt-4">
                  <div className="text-sm font-medium" style={{color: theme.heading}}>Чему научитесь</div>
                  <ul className="list-disc ml-5 mt-1 text-sm opacity-90 space-y-1">
                    {p.learn.map((a,i)=><li key={i}>{a}</li>)}
                  </ul>
                </div>

                <div className="mt-4 text-sm opacity-90">
                  <span className="font-medium">Документ: </span>{p.diploma}
                </div>

                <div className="mt-5 flex flex-wrap gap-2">
                  <button
                    className="px-4 py-2 rounded-xl text-white pressable"
                    style={{ backgroundImage: gradient }}
                    onClick={() => openUrl(p.landing_url)}
                  >
                    Перейти на сайт
                  </button>
                  <button
                    className="px-4 py-2 rounded-xl glass pressable"
                    onClick={() => openTelegram('https://t.me/netology')}
                  >
                    Написать менеджеру
                  </button>
                </div>
              </Modal>
            )}
          </div>
        );
      }

      function CompareTable({ ids, onReset, theme }) {
        const data = PROGRAMS.filter(p => ids.includes(p.id));
        if (!data.length) return null;

        return (
          <div className="rounded-3xl p-4 neon-ring" style={{ background: theme.panel }}>
            <div className="flex items-center justify-between gap-2">
              <div className="text-base font-semibold" style={{color: theme.heading}}>Сравнение программ</div>
              <button onClick={onReset} className="px-3 py-1.5 rounded-xl text-sm glass pressable">Сбросить</button>
            </div>

            <div className="table-scroll mt-3 rounded-2xl">
              <table className="min-w-[760px] w-full text-sm leading-snug sticky-first">
                <thead>
                  <tr className="text-left">
                    <th className="py-2 pr-3 w-[28%]">Программа</th>
                    <th className="py-2 pr-3 w-[16%]">Вуз-партнёр</th>
                    <th className="py-2 pr-3 w-[12%]">Старт</th>
                    <th className="py-2 pr-3 w-[12%]">Длительность</th>
                    <th className="py-2 pr-3 w-[12%]">Цена</th>
                    <th className="py-2 pr-3 w-[14%]">От ₽/мес</th>
                    <th className="py-2 pr-3 w-[40%]">Навыки</th>
                  </tr>
                </thead>
                <tbody>
                  {data.map(p => (
                    <tr key={p.id} className="border-t border-black/10 dark:border-white/20 align-top">
                      <td className="py-2 pr-3 font-medium">{p.title}</td>
                      <td className="py-2 pr-3">{p.partners.join(', ')}</td>
                      <td className="py-2 pr-3">{dstr(p.start_date)}</td>
                      <td className="py-2 pr-3">{p.duration_months_est} мес</td>
                      <td className="py-2 pr-3">{rub(p.price_full_rub)} ₽</td>
                      <td className="py-2 pr-3">{rub(p.price_from_per_month_rub)} ₽</td>
                      <td className="py-2 pr-3 opacity-90">{p.learn.join(' · ')}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        );
      }

      function Filters({ partner, setPartner, theme }) {
        const partners = useMemo(() => {
          const set = new Set();
          PROGRAMS.forEach(p => p.partners.forEach(x => set.add(x)));
          return ['Все вузы', ...Array.from(set)];
        }, []);
        return (
          <div className="flex gap-2">
            <select
              value={partner}
              onChange={(e)=>{ haptic.selection(); setPartner(e.target.value); }}
              className="w-full md:w-1/3 glass neon-ring rounded-2xl px-3 py-2"
            >
              {partners.map(p => <option key={p} value={p}>{p}</option>)}
            </select>
          </div>
        );
      }

      function App() {
        const [partner, setPartner] = useState('Все вузы');
        const [compareIds, setCompareIds] = useState([]);
        const theme = useTelegramTheme();

        useEffect(() => {
          const tg = getTG();
          if (tg) {
            try { tg.ready(); tg.expand?.(); tg.setHeaderColor?.('bg_color'); tg.setBackgroundColor?.('secondary_bg_color'); } catch {}
          }
        }, []);

        const filtered = useMemo(
          () => PROGRAMS.filter(p => partner === 'Все вузы' || p.partners.includes(partner)),
          [partner]
        );
        const toggleCompare = (id) =>
          setCompareIds(prev => (prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id].slice(-4)));

        return (
          <div className="min-h-screen">
            <TopBar theme={theme} />
            <main className="max-w-5xl mx-auto px-4 pb-[calc(40px+var(--sab))]">
              <header className="pt-3 pb-2">
                <h1 className="text-lg md:text-xl font-semibold" style={{color: theme.heading}}>
                  Программы ДПО с дипломом вуза
                </h1>
                <p className="opacity-90 text-sm md:text-base" style={{color: theme.text}}>
                  Перетащили подробности внутрь модалки, а карточки сделали легче.
                </p>
              </header>

              <section className="mt-2">
                <Filters partner={partner} setPartner={setPartner} theme={theme} />
              </section>

              <section className="mt-4">
                <CompareTable ids={compareIds} onReset={()=>setCompareIds([])} theme={theme} />
              </section>

              <section className="mt-4 grid gap-3">
                {filtered.map(p => (
                  <ProgramCard key={p.id} p={p} onCompareToggle={toggleCompare} selected={compareIds.includes(p.id)} theme={theme} />
                ))}
              </section>

              <footer className="text-center text-xs opacity-80 mt-8" style={{color: theme.text}}>
                Информация не является публичной офертой. Уточняйте условия у менеджера.
              </footer>
            </main>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
