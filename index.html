<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Нетология ДПО — Telegram Mini-app</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root{
      --sat: env(safe-area-inset-top);
      --sab: env(safe-area-inset-bottom);
      --app-vh: 100vh;
      --sticky-gap: 12px;
      --g1:#00D2FF; --g2:#24B6FF;
    }
    html,body{height:100%}
    body{
      margin:0;
      background: var(--tg-theme-secondary-bg-color, #f6f7f9);
      color: var(--tg-theme-text-color, #121417);
      min-height: calc(var(--app-vh));
      -webkit-font-smoothing: antialiased;
    }
    @media (prefers-color-scheme: dark){
      body{
        background: var(--tg-theme-secondary-bg-color, #0f1116);
        color: var(--tg-theme-text-color, #e9edf1);
      }
    }

    .glass{
      background: rgba(255,255,255,.6);
      -webkit-backdrop-filter: blur(18px) saturate(140%);
      backdrop-filter: blur(18px) saturate(140%);
      border: 1px solid rgba(0,0,0,.06);
    }
    @media (prefers-color-scheme: dark){
      .glass{
        background: rgba(22,25,30,.6);
        border-color: rgba(255,255,255,.12);
      }
    }

    .pressable{transition:.08s transform ease,.18s filter ease}
    .pressable:active{transform:translateY(1px) scale(.996);filter:saturate(1.05)}

    /* bottom sheet */
    .sheet-overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:1000;opacity:0;pointer-events:none;transition:opacity .18s ease}
    .sheet{position:fixed;left:0;right:0;bottom:0;z-index:1001;transform:translateY(100%);transition:transform .24s cubic-bezier(.2,.8,.2,1)}
    .sheet-open .sheet-overlay{opacity:1;pointer-events:auto}
    .sheet-open .sheet{transform:translateY(0)}
    .sheet-body{padding:14px 16px calc(16px + var(--sab))}

    /* compare table */
    .table-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch;padding-bottom:6px}
    .sticky-first th:first-child,.sticky-first td:first-child{
      position:sticky;left:0;z-index:2;background:rgba(255,255,255,.92);
      -webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);
      box-shadow:6px 0 12px -6px rgba(0,0,0,.08);
      padding-right:calc(var(--sticky-gap) + 12px)!important;
    }
    .sticky-first th:nth-child(2),.sticky-first td:nth-child(2){
      padding-left:calc(var(--sticky-gap) + 12px)!important;
    }
    @media (prefers-color-scheme: dark){
      .sticky-first th:first-child,.sticky-first td:first-child{
        background:rgba(18,20,24,.9);
        box-shadow:6px 0 12px -6px rgba(0,0,0,.55);
      }
    }

    /* логотип — SVG как есть, цвет меняем фильтром в дарке */
    .logo-wrap{display:inline-block;line-height:0}
    .logo-wrap svg{display:block;width:139px;height:21px}
    @media (prefers-color-scheme: dark){
      .logo-wrap{filter:invert(1)}
    }

    /* скидка: выделенная карточка с градиентной подложкой */
    .discount{
      background-image: linear-gradient(90deg,var(--g1),var(--g2));
      border-radius: 16px;
      padding: 16px;
    }
    .discount .title,.discount .text{color:#fff}
    .discount .btn{background:#fff;color:#0f1116}

  </style>
</head>
<body>
  <div id="root"></div>
  <div id="portal-root"></div>

  <script type="text/babel">
  const {useEffect, useMemo, useState} = React;

  /* fix vh for Telegram */
  (()=>{ const tg=window?.Telegram?.WebApp;
    const set=()=>{const h=tg?.viewportStableHeight||window.innerHeight;document.documentElement.style.setProperty('--app-vh',h+'px');};
    set(); window.addEventListener('resize',set); tg?.onEvent?.('viewportChanged',set);
  })();

  const SETTINGS={
    manager:{tg_username:'@netology_vo'},
    webinars_url:'https://netology.ru/free/degree',
    telegram_channel:'@netology_degree',
    /* твой SVG — ОРИГИНАЛ БЕЗ ИЗМЕНЕНИЙ (ASCII V) */
    logoSvg:`<svg width="139" height="21" viewBox="0 0 139 21" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4.93457 10.832C5.06997 10.832 5.20427 10.8389 5.33691 10.8496C5.62497 13.1513 7.498 14.9586 9.8291 15.1475C9.85457 15.3506 9.87012 15.5576 9.87012 15.7676C9.86997 18.4929 7.65991 20.7021 4.93457 20.7021C2.20935 20.702 0.000148475 18.4928 0 15.7676C2.70757e-07 13.0422 2.20926 10.8322 4.93457 10.832Z" fill="black"/>
<path d="M4.93457 0C7.65987 2.70752e-07 9.8699 2.20932 9.87012 4.93457C9.87012 5.06098 9.86285 5.18652 9.85352 5.31055C7.42987 5.49485 5.49668 7.42956 5.31348 9.85352C5.18846 9.86301 5.06202 9.87012 4.93457 9.87012C2.20926 9.86997 -2.70757e-07 7.65991 0 4.93457C0.00021228 2.20941 2.20939 0.000143085 4.93457 0Z" fill="black"/>
<path d="M15.7705 0C18.4959 5.09014e-07 20.7049 2.20926 20.7051 4.93457C20.7051 7.66 18.4959 9.87012 15.7705 9.87012C15.56 9.87011 15.353 9.8537 15.1494 9.82812C14.9611 7.49666 13.1543 5.62437 10.8525 5.33594C10.8419 5.20362 10.8359 5.06963 10.8359 4.93457C10.8361 2.20928 13.0452 4.37426e-05 15.7705 0Z" fill="black"/>
<path d="M15.7705 10.832C18.4959 10.832 20.7051 13.0421 20.7051 15.7676C20.7049 18.4928 18.4958 20.7021 15.7705 20.7021C13.0452 20.7021 10.8362 18.4928 10.8359 15.7676C10.8359 15.5485 10.8512 15.3326 10.8789 15.1211C13.088 14.8321 14.8358 13.0843 15.124 10.875C15.3356 10.8473 15.5514 10.832 15.7705 10.832Z" fill="black"/>
<path d="M27.2109 4.40968H30.1593V9.00602H35.2074V4.40968H38.1558V16.2929H35.2074V11.4724H30.1593V16.2929H27.2109V4.40968Z" fill="black"/>
<path d="M46.2047 16.562C45.4006 16.562 44.6338 16.4424 43.9041 16.2032C43.1893 15.9491 42.5639 15.5754 42.0278 15.0822C41.4918 14.574 41.0674 13.9387 40.7547 13.1764C40.442 12.3991 40.2856 11.4948 40.2856 10.4634V10.015C40.2856 9.02844 40.4345 8.16897 40.7323 7.43654C41.0301 6.70411 41.4396 6.09874 41.9608 5.62042C42.482 5.12716 43.0851 4.76095 43.7701 4.52179C44.4551 4.26768 45.1922 4.14062 45.9814 4.14062C47.8428 4.14062 49.2574 4.63389 50.2253 5.62042C51.1932 6.60696 51.6772 8.03444 51.6772 9.90287V11.1585H43.301C43.3159 11.6816 43.4053 12.1375 43.5691 12.5261C43.7329 12.8998 43.9488 13.2063 44.2168 13.4454C44.4848 13.6846 44.7901 13.8639 45.1326 13.9835C45.49 14.0882 45.8474 14.1405 46.2047 14.1405C46.9642 14.1405 47.5375 14.0284 47.9247 13.8042C48.3118 13.5799 48.5873 13.2511 48.7511 12.8176H51.4538C51.2156 14.0583 50.6274 14.9925 49.6892 15.6203C48.7511 16.2481 47.5896 16.562 46.2047 16.562ZM46.0931 6.56211C45.7506 6.56211 45.4081 6.60696 45.0656 6.69664C44.738 6.78632 44.4476 6.92833 44.1945 7.12264C43.9413 7.31696 43.7329 7.57854 43.5691 7.90738C43.4053 8.23623 43.3159 8.63234 43.301 9.09571H48.8181C48.8032 8.60244 48.7213 8.19139 48.5724 7.86254C48.4384 7.5337 48.2448 7.27212 47.9917 7.0778C47.7534 6.88348 47.4705 6.74896 47.1429 6.67422C46.8153 6.59948 46.4653 6.56211 46.0931 6.56211Z" fill="black"/>
<path d="M56.4641 6.87601H52.6893V4.40968H63.1874V6.87601H59.4126V16.2929H56.4641В6.87601З" fill="black"/>
<path d="M70.1117 16.562C69.3076 16.562 68.5407 16.4424 67.811 16.2032C67.0963 15.9491 66.4709 15.568 65.9348 15.0597C65.3987 14.5515 64.9743 13.9163 64.6616 13.1539C64.3489 12.3916 64.1926 11.4948 64.1926 10.4634V10.015C64.1926 9.04339 64.3489 8.19139 64.6616 7.45896C64.9743 6.72654 65.3987 6.11369 65.9348 5.62042C66.4709 5.12716 67.0963 4.76095 67.811 4.52179C68.5407 4.26768 69.3076 4.14062 70.1117 4.14062C70.9158 4.14062 71.6753 4.26768 72.39 4.52179C73.1048 4.76095 73.7302 5.12716 74.2663 5.62042C74.8172 6.11369 75.2491 6.72654 75.5618 7.45896C75.8745 8.19139 76.0309 9.04339 76.0309 10.015V10.4634C76.0309 11.4798 75.8745 12.3692 75.5618 13.1315C75.2491 13.8938 74.8172 14.5291 74.2663 15.0373C73.7302 15.5455 73.1048 15.9267 72.39 16.1808C71.6753 16.4349 70.9158 16.562 70.1117 16.562Z" fill="black"/>
<path d="M78.0376 16.562C77.9185 16.562 77.7696 16.5545 77.5909 16.5395C77.4122 16.5395 77.2633 16.5246 77.1442 16.4947V13.8266C77.2186 13.8415 77.3303 13.849 77.4792 13.849C77.7622 13.849 78.0079 13.7668 78.2163 13.6024C78.4248 13.423 78.5961 13.124 78.7301 12.7055C78.879 12.287 78.9832 11.7339 79.0428 11.0464C79.1172 10.3438 79.1545 9.47687 79.1545 8.44549V4.40968H88.5358V16.2929H85.5874V6.87601H81.8795V8.89392C81.8795 10.4335 81.7976 11.704 81.6338 12.7055C81.4849 13.6921 81.2466 14.4693 80.919 15.0373C80.6063 15.6053 80.2043 16.0014 79.7129 16.2256C79.2364 16.4499 78.678 16.562 78.0376 16.562Z" fill="black"/>
<path d="M96.5708 16.562C95.7667 16.562 94.9998 16.4424 94.2701 16.2032C93.5554 15.9491 92.9299 15.568 92.3939 15.0597C91.8578 14.5515 91.4334 13.9163 91.1207 13.1539C90.808 12.3916 90.6516 11.4948 90.6516 10.4634V10.015C90.6516 9.04339 90.808 8.19139 91.1207 7.45896C91.4334 6.72654 91.8578 6.11369 92.3939 5.62042C92.9299 5.12716 93.5554 4.76095 94.2701 4.52179C94.9998 4.26768 95.7667 4.14062 96.5708 4.14062C97.3749 4.14062 98.1343 4.26768 98.8491 4.52179C99.5638 4.76095 100.189 5.12716 100.725 5.62042C101.276 6.11369 101.708 6.72654 102.021 7.45896C102.334 8.19139 102.49 9.04339 102.49 10.015V10.4634C102.49 11.4798 102.334 12.3692 102.021 13.1315C101.708 13.8938 101.276 14.5291 100.725 15.0373C100.189 15.5455 99.5638 15.9267 98.8491 16.1808C98.1343 16.4349 97.3749 16.562 96.5708 16.562Z" fill="black"/>
<path d="M104.827 4.40968H113.314V6.87601H107.775V16.2929H104.827V4.40968Z" fill="black"/>
<path d="M115.095 4.40968H118.044V12.0329L123.315 4.40968H126.04V16.2929H123.092V8.66971L117.82 16.2929H115.095V4.40968Z" fill="black"/>
<path d="M131.118 11.8311C130.21 11.5321 129.547 11.0837 129.13 10.4858C128.713 9.88792 128.505 9.18539 128.505 8.37823C128.505 7.79528 128.602 7.26464 128.795 6.78633C129.004 6.29306 129.309 5.87453 129.711 5.53074C130.113 5.172 130.619 4.89547 131.23 4.70116C131.855 4.50684 132.585 4.40968 133.419 4.40968H139.003V16.2929H136.055V12.1898H133.933L131.364 16.2929H128.058L131.118 11.8311ZM131.453 8.37823C131.453 8.88644 131.617 9.26013 131.945 9.49929C132.287 9.73845 132.741 9.85803 133.307 9.85803H136.055V6.87601H133.307C132.741 6.87601 132.287 7.00306 131.945 7.25717C131.617 7.49633 131.453 7.87002 131.453 8.37823Z" fill="black"/>
</svg>`
  };

  const tg = () => window?.Telegram?.WebApp;

  /* универсальный переход в чат с автотекстом */
  function buildText(ctx, title=''){
    if(ctx==='header') return 'Здравствуйте! Интересуют программы ДПО Нетологии. Подскажите, пожалуйста, как записаться?';
    if(ctx==='discount') return 'Здравствуйте! Хочу получить скидку 10 000 ₽ на курс. Подскажите, как это сделать?';
    return `Здравствуйте! Меня заинтересовала программа «${title}». Расскажите, пожалуйста, подробнее.`;
  }
  function managerLink(ctx, title=''){
    const user = SETTINGS.manager.tg_username.replace('@','');
    const enc  = encodeURIComponent(buildText(ctx,title)).replace(/%20/g,'+');
    return `https://t.me/${user}?text=${enc}`;
  }
  function openManager(ctx,title=''){
    const link = managerLink(ctx,title);
    const T = tg();
    if (T?.openTelegramLink) T.openTelegramLink(link);
    else window.open(link,'_blank','noopener');
  }

  function useTGTheme(){
    const [th,setTh]=React.useState(()=>{
      const T=tg(); const p=T?.themeParams||{}; const dark=T?.colorScheme==='dark';
      return {
        dark,
        text: p.text_color || (dark?'#e9edf1':'#121417'),
        heading: p.text_color || (dark?'#ffffff':'#0b0d10'),
        border: p.section_separator_color || (dark?'rgba(255,255,255,.14)':'rgba(0,0,0,.08)'),
        panel: dark ? 'rgba(22,25,30,.6)' : 'rgba(255,255,255,.6)',
        grad: 'linear-gradient(90deg,var(--g1),var(--g2))'
      };
    });
    React.useEffect(()=>{
      const T=tg(); const upd=()=>setTh(s=>({...s, dark:T?.colorScheme==='dark'}));
      T?.onEvent?.('themeChanged',upd); return ()=>T?.offEvent?.('themeChanged',upd);
    },[]);
    return th;
  }

  const PROGRAMS=[
    { id:'py', title:'Python: от кода к стартапу', partners:['МФТИ'], start_date:'2025-10-20', duration_months_est:7, price_full_rub:158400, price_from_per_month_rub:6947, landing_url:'https://netology.ru/programs/razrabotchik-na-python-s-mfti', audience:['Новичкам для входа в разработку','Аналитикам/инженерам для автоматизации','QA/DevOps/BI — усилить кодинг'], diploma:'Два диплома о профпереподготовке: МФТИ и Нетологии', learn:['Python, API, БД','Web/боты/деплой','Проект: от идеи до MVP'], about:'Путь от базового кода до работающего MVP и питча.' },
    { id:'ai-pm', title:'Руководитель проектов в области ИИ', partners:['МФТИ'], start_date:'2025-12-08', duration_months_est:3, price_full_rub:114700, price_from_per_month_rub:5031, landing_url:'https://netology.ru/programs/rukovoditel-proektov-v-oblasti-iskusstvennogo-intellekta-dpo-mfti', audience:['Продактам и менеджерам AI-инициатив','Руководителям, внедряющим ИИ','Координаторам ML/DS-команд'], diploma:'Два удостоверения о повышении квалификации: МФТИ и Нетологии', learn:['Цикл AI-проекта и внедрение','Оценка эффекта и рисков','Коммуникация бизнес ↔ ML'], about:'Системный менеджмент AI-проектов от постановки до релиза.' }
  ];
  const rub=n=>new Intl.NumberFormat('ru-RU').format(n);
  const dstr=s=>new Date(s).toLocaleDateString('ru-RU',{day:'2-digit',month:'long',year:'numeric'});

  const Portal=({children})=>ReactDOM.createPortal(children,document.getElementById('portal-root'));

  function BottomSheet({title,onClose,children,theme}){
    const [open,setOpen]=useState(true);
    useEffect(()=>{ const T=tg(); const back=()=>onClose?.(); try{T?.BackButton?.show();}catch{} T?.onEvent?.('backButtonClicked',back); document.body.style.overflow='hidden'; return ()=>{document.body.style.overflow=''; try{T?.BackButton?.hide();}catch{} T?.offEvent?.('backButtonClicked',back);} },[onClose]);
    return (
      <Portal>
        <div className={open?'sheet-open':''}>
          <div className="sheet-overlay" onClick={()=>{setOpen(false);setTimeout(onClose,180);}}></div>
          <div className="sheet glass rounded-t-2xl" style={{borderTop:`1px solid ${theme.border}`}}>
            <div className="flex justify-end px-3 pt-3">
              <button className="pressable px-3 py-1.5 rounded-full text-sm font-medium"
                style={{background:theme.panel,border:`1px solid ${theme.border}`}}
                onClick={()=>{setOpen(false);setTimeout(onClose,180);}} aria-label="Закрыть">× Закрыть</button>
            </div>
            <div className="sheet-body">
              <h3 className="text-lg font-semibold mb-2" style={{color:theme.heading}}>{title}</h3>
              {children}
            </div>
          </div>
        </div>
      </Portal>
    );
  }

  const Chip=({children})=><span className="px-2 py-1 rounded-full text-[11px] leading-none glass">{children}</span>;

  function LogoBrand(){
    const dark = tg()?.colorScheme==='dark';
    return <span className="logo-wrap" style={dark?{filter:'invert(1)'}:null}
      dangerouslySetInnerHTML={{__html:SETTINGS.logoSvg}}/>;
  }

  function TopBar({theme}){
    const href=managerLink('header');
    return (
      <div className="sticky top-0 z-20" style={{backdropFilter:'blur(6px) saturate(140%)'}}>
        <div className="max-w-5xl mx-auto px-4 pt-[calc(8px+var(--sat))] pb-3">
          <div className="rounded-2xl px-3 py-2 glass" style={{border:`1px solid ${theme.border}`}}>
            <div className="flex items-center justify-between gap-3">
              <LogoBrand />
              <a href={href}
                 onClick={(e)=>{e.preventDefault();openManager('header');}}
                 className="px-3 py-1.5 rounded-xl text-sm text-white pressable"
                 style={{backgroundImage:theme.grad}}>
                Написать менеджеру
              </a>
            </div>
          </div>
        </div>
      </div>
    );
  }

  function ProgramCard({p,onCompareToggle,selected,theme}){
    const [open,setOpen]=useState(false);
    return (
      <div className="rounded-3xl p-4 md:p-5 pressable" style={{background:theme.panel,border:`1px solid ${theme.border}`}}>
        <div className="flex items-start justify-between gap-3">
          <div>
            <div className="text-base md:text-lg font-semibold" style={{color:theme.heading}}>{p.title}</div>
            <div className="mt-1 text-sm opacity-85" style={{color:theme.text}}>Партнёр: {p.partners.join(', ')}</div>
            <div className="mt-3 flex flex-wrap gap-1.5">
              <Chip>Старт: {dstr(p.start_date)}</Chip>
              <Chip>{p.duration_months_est} мес</Chip>
              <Chip>{rub(p.price_full_rub)} ₽</Chip>
              <Chip>от {rub(p.price_from_per_month_rub)} ₽/мес</Chip>
            </div>
          </div>
          <button onClick={()=>onCompareToggle(p.id)} className={`px-3 py-2 rounded-xl text-xs md:text-sm glass ${selected?'font-semibold':''}`}>
            {selected?'В сравнении':'Сравнить'}
          </button>
        </div>

        <div className="mt-4 grid grid-cols-2 gap-2">
          <a className="py-2 rounded-xl text-white pressable text-center" style={{backgroundImage:theme.grad}} href={p.landing_url} target="_blank" rel="noopener">Открыть программу</a>
          <button className="py-2 rounded-xl pressable glass" onClick={()=>setOpen(true)}>Подробнее</button>
        </div>

        {open && (
          <BottomSheet title={p.title} onClose={()=>setOpen(false)} theme={theme}>
            <div className="text-sm opacity-90" style={{color:theme.text}}>
              <div className="mb-2"><span className="font-medium">Вуз-партнёр:</span> {p.partners.join(', ')}</div>
              {p.about}
            </div>

            <div className="mt-4">
              <div className="text-sm font-medium" style={{color:theme.heading}}>Кому подойдёт</div>
              <ul className="list-disc ml-5 mt-1 text-sm opacity-90 space-y-1" style={{color:theme.text}}>
                {p.audience.map((a,i)=><li key={i}>{a}</li>)}
              </ul>
            </div>

            <div className="mt-4">
              <div className="text-sm font-medium" style={{color:theme.heading}}>Чему научитесь</div>
              <ul className="list-disc ml-5 mt-1 text-sm opacity-90 space-y-1" style={{color:theme.text}}>
                {p.learn.map((a,i)=><li key={i}>{a}</li>)}
              </ul>
            </div>

            <div className="mt-4 text-sm opacity-90" style={{color:theme.text}}>
              <span className="font-medium">Документ: </span>{p.diploma}
            </div>

            <div className="mt-5 flex flex-wrap gap-2">
              <a className="px-4 py-2 rounded-xl text-white pressable" style={{backgroundImage:theme.grad}} href={p.landing_url} target="_blank" rel="noopener">Перейти на сайт</a>
              <a className="px-4 py-2 rounded-xl glass pressable" href={managerLink('program',p.title)} onClick={(e)=>{e.preventDefault();openManager('program',p.title);}}>Написать менеджеру</a>
            </div>
          </BottomSheet>
        )}
      </div>
    );
  }

  function CompareTable({ids,onReset,theme}){
    const data=PROGRAMS.filter(p=>ids.includes(p.id)); if(!data.length) return null;
    return (
      <div className="rounded-3xl p-4" style={{background:theme.panel,border:`1px solid ${theme.border}`}}>
        <div className="flex items-center justify-between">
          <div className="text-base font-semibold" style={{color:theme.heading}}>Сравнение программ</div>
          <button onClick={onReset} className="px-3 py-1.5 rounded-xl text-sm glass pressable">Сбросить</button>
        </div>
        <div className="table-scroll mt-3 rounded-2xl">
          <table className="min-w-[780px] w-full text-sm leading-snug sticky-first">
            <thead>
              <tr className="text-left">
                <th className="pl-3 pr-3 py-2 w-[28%]">Программа</th>
                <th className="pr-3 py-2 w-[16%]">Вуз-партнёр</th>
                <th className="pr-3 py-2 w-[12%]">Старт</th>
                <th className="pr-3 py-2 w-[12%]">Длительность</th>
                <th className="pr-3 py-2 w-[12%]">Цена</th>
                <th className="pr-3 py-2 w-[14%]">От ₽/мес</th>
                <th className="pr-3 py-2 w-[42%]">Навыки</th>
              </tr>
            </thead>
            <tbody>
              {data.map(p=>(
                <tr key={p.id} className="border-t align-top" style={{borderColor:theme.border}}>
                  <td className="pl-3 pr-3 py-2 font-medium">{p.title}</td>
                  <td className="pr-3 py-2">{p.partners.join(', ')}</td>
                  <td className="pr-3 py-2">{dstr(p.start_date)}</td>
                  <td className="pr-3 py-2">{p.duration_months_est} мес</td>
                  <td className="pr-3 py-2">{rub(p.price_full_rub)} ₽</td>
                  <td className="pr-3 py-2">{rub(p.price_from_per_month_rub)} ₽</td>
                  <td className="pr-3 py-2 opacity-90">{p.learn.join(' · ')}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    );
  }

  function IntroBlocks({theme}){
    return (
      <div className="grid md:grid-cols-2 gap-3">
        <div className="rounded-2xl p-4 glass" style={{border:`1px solid ${theme.border}`}}>
          <div className="text-sm font-medium" style={{color:theme.heading}}>Что такое ДПО</div>
          <div className="mt-1 text-xs" style={{color:theme.text}}>
            Это программы повышения квалификации или профессиональной переподготовки. Итог — документ вуза-партнёра и документ Нетологии (тип зависит от программы).
          </div>
        </div>
        <div className="rounded-2xl p-4 glass" style={{border:`1px solid ${theme.border}`}}>
          <div className="text-sm font-medium" style={{color:theme.heading}}>Формат</div>
          <div className="mt-1 text-xs" style={{color:theme.text}}>
            Онлайн-занятия и записи, гибкий график. Рекомендованная нагрузка — 20–30 ч/нед.
          </div>
        </div>
      </div>
    );
  }

  function DiscountBlock({theme}){
    return (
      <div className="discount">
        <div className="title text-base font-semibold mb-1">Скидка 10 000 ₽ на курс</div>
        <div className="text text-xs mb-3">Напишите менеджеру — расскажем условия и применим скидку к вашей программе.</div>
        <a className="btn inline-block px-4 py-2 rounded-xl pressable"
           href={managerLink('discount')}
           onClick={(e)=>{e.preventDefault();openManager('discount');}}>
          Получить скидку
        </a>
      </div>
    );
  }

  function WebinarsAndTG({theme}){
    return (
      <>
        <div className="rounded-2xl p-4" style={{background:theme.panel,border:`1px solid ${theme.border}`}}>
          <div className="text-base font-semibold" style={{color:theme.heading}}>Бесплатные мероприятия</div>
          <div className="text-xs mt-1" style={{color:theme.text}}>Открытые эфиры: формат, учебный план, ответы на вопросы. Запись отправим после эфира.</div>
          <a className="mt-3 inline-block px-4 py-2 rounded-xl text-white pressable"
             style={{backgroundImage:'linear-gradient(90deg,var(--g1),var(--g2))'}}
             href={SETTINGS.webinars_url} target="_blank" rel="noopener">Календарь</a>
        </div>

        <div className="rounded-2xl p-4" style={{background:theme.panel,border:`1px solid ${theme.border}`}}>
          <div className="text-base font-semibold mb-1" style={{color:theme.heading}}>Telegram-канал Нетологии</div>
          <div className="text-xs mb-3" style={{color:theme.text}}>Новости, обновления программ и бесплатные мероприятия.</div>
          <a className="px-4 py-2 rounded-xl text-white pressable inline-block"
             style={{backgroundImage:'linear-gradient(90deg,var(--g1),var(--g2))'}}
             href={`https://t.me/${SETTINGS.telegram_channel.replace('@','')}`} target="_blank" rel="noopener">
            Перейти в канал {SETTINGS.telegram_channel}
          </a>
        </div>
      </>
    );
  }

  function Filters({partner,setPartner,theme}){
    const partners=React.useMemo(()=>{const s=new Set();PROGRAMS.forEach(p=>p.partners.forEach(x=>s.add(x)));return ['Все вузы',...Array.from(s)];},[]);
    return (
      <div className="flex gap-2">
        <select value={partner} onChange={e=>setPartner(e.target.value)}
          className="px-3 py-2 rounded-2xl glass w-full md:w-1/3" style={{border:`1px solid ${theme.border}`}}>
          {partners.map(p=><option key={p} value={p}>{p}</option>)}
        </select>
      </div>
    );
  }

  function App(){
    const theme=useTGTheme();
    const [partner,setPartner]=useState('Все вузы');
    const [compareIds,setCompareIds]=useState([]);

    useEffect(()=>{const T=tg(); if(T){try{T.ready();T.expand?.();T.setHeaderColor?.('bg_color');T.setBackgroundColor?.('secondary_bg_color');}catch{}}},[]);

    const filtered=useMemo(()=>PROGRAMS.filter(p=>partner==='Все вузы'||p.partners.includes(partner)),[partner]);
    const toggleCompare=id=>setCompareIds(prev=>prev.includes(id)?prev.filter(x=>x!==id):[...prev,id].slice(-4));

    return (
      <div style={{minHeight:'calc(var(--app-vh))',paddingBottom:'calc(16px + var(--sab))'}}>
        <TopBar theme={theme}/>
        <main className="max-w-5xl mx-auto px-4">
          <header className="pt-2 pb-2">
            <h1 className="text-lg md:text-xl font-semibold" style={{color:theme.heading}}>Программы ДПО с дипломом вуза</h1>
            <p className="mt-1 text-sm md:text-base" style={{color:theme.text}}>Карточки — лёгкие; подробности — в модалке-шите. Цвета и градиент — как у Нетологии.</p>
          </header>

          <div className="mt-3"><IntroBlocks theme={theme}/></div>
          <section className="mt-3"><Filters partner={partner} setPartner={setPartner} theme={theme}/></section>
          <section className="mt-4"><CompareTable ids={compareIds} onReset={()=>setCompareIds([])} theme={theme}/></section>

          <section className="mt-4 grid gap-3">
            {filtered.map(p=>(
              <ProgramCard key={p.id} p={p} onCompareToggle={toggleCompare} selected={compareIds.includes(p.id)} theme={theme}/>
            ))}
          </section>

          <section className="mt-5 grid gap-3">
            <DiscountBlock theme={theme}/>
            <WebinarsAndTG theme={theme}/>
          </section>

          <footer className="text-center text-xs opacity-80 mt-8 mb-[calc(8px+var(--sab))]" style={{color:theme.text}}>
            Информация не является публичной офертой. Актуальные условия уточняйте у менеджера.
          </footer>
        </main>
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
